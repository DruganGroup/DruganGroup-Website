<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Request #{{ req[0] }} | {{ company_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --brand-color: {{ brand_color or '#0d6efd' }}; }
        body { background-color: #f4f7f6; font-family: 'Segoe UI', sans-serif; }
        .navbar { background-color: white; border-bottom: 3px solid var(--brand-color); }
        .text-brand { color: var(--brand-color); }
        .status-Pending { color: #856404; background-color: #fff3cd; }
        .status-Completed { color: #0f5132; background-color: #d1e7dd; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg shadow-sm mb-4">
    <div class="container">
        <a href="/portal/home" class="btn btn-sm btn-outline-secondary me-3"><i class="fas fa-arrow-left"></i> Back</a>
        <h5 class="m-0 fw-bold text-brand">Request #{{ req[0] }}</h5>
    </div>
</nav>

<div class="container" style="max-width: 800px;">
    
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between mb-3">
                <h5 class="fw-bold">Reported Issue</h5>
                <span class="badge status-{{ req[2] }} fs-6">{{ req[2] }}</span>
            </div>
            <div class="row g-3">
                <div class="col-md-6">
                    <small class="text-muted d-block">Property</small>
                    <strong>{{ req[5] }}</strong> ({{ req[6] }})
                </div>
                <div class="col-md-6 text-md-end">
                    <small class="text-muted d-block">Date Reported</small>
                    <strong>{{ req[3].strftime('%d %b %Y') }}</strong>
                </div>
                <div class="col-12 bg-light p-3 rounded mt-3">
                    <small class="text-muted d-block mb-1">Description</small>
                    <p class="m-0">{{ req[1] }}</p>
                </div>
            </div>
        </div>
    </div>

    {% if completion %}
    <div class="card shadow-sm border-0 border-top border-5 border-success">
        <div class="card-header bg-success text-white">
            <h5 class="m-0"><i class="fas fa-check-circle me-2"></i>Job Completion Report</h5>
        </div>
        <div class="card-body p-4">
            <div class="row mb-4">
                <div class="col-md-6">
                    <small class="text-muted">Completed By</small>
                    <h5 class="fw-bold">{{ completion[3] or 'Senior Engineer' }}</h5>
                </div>
                <div class="col-md-6 text-md-end">
                    <small class="text-muted">Date Finished</small>
                    <h5 class="fw-bold">{{ completion[1].strftime('%d %b %Y') if completion[1] else 'Recently' }}</h5>
                </div>
            </div>

            <div class="mb-4">
                <h6 class="fw-bold">Engineer's Notes</h6>
                <p>{{ completion[0] or 'Job completed successfully as requested.' }}</p>
            </div>

            {% if completion[2] %}
            <h6 class="fw-bold mb-3">Proof of Work (Photos)</h6>
            <div class="d-flex gap-3 overflow-auto pb-3">
                <img src="{{ completion[2] }}" class="rounded shadow-sm" style="height: 150px; object-fit: cover;" alt="Job Photo">
            </div>
            {% endif %}
        </div>
    </div>
    {% elif req[2] == 'Completed' %}
    <div class="alert alert-success">
        <i class="fas fa-check me-2"></i> This issue has been marked as resolved.
    </div>
    {% endif %}

</div>

</body>
</html>