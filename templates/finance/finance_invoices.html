{% extends "finance/finance_base.html" %}

{% block title %}Sales Ledger | Business Better{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold m-0">Sales Ledger</h2>
            <p class="text-muted mb-0">Track all invoices and payments</p>
        </div>
        <div class="btn-group shadow-sm">
             <button class="btn btn-outline-dark fw-bold"><i class="fas fa-filter me-2"></i>Filter</button>
             <button class="btn btn-primary fw-bold"><i class="fas fa-plus me-2"></i>New Invoice</button>
        </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="card-header bg-white p-3 border-bottom d-flex justify-content-between">
            <h5 class="fw-bold m-0 text-secondary">All Invoices</h5>
            <span class="badge bg-light text-dark border">{{ invoices|length }} Records</span>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light text-uppercase small">
                    <tr>
                        <th class="ps-4">Invoice #</th>
                        <th>Client</th>
                        <th>Date</th>
                        <th>Due</th>
                        <th>Status</th>
                        <th class="text-end pe-4">Total</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for inv in invoices %}
                    <tr>
                        <td class="ps-4 fw-bold text-primary">{{ inv.ref }}</td>
                        <td>{{ inv.client }}</td>
                        <td class="small">{{ inv.date }}</td>
                        <td class="small {{ 'text-danger fw-bold' if inv.status == 'Unpaid' else 'text-muted' }}">{{ inv.due }}</td>
                        <td>
                            {% if inv.status == 'Paid' %}
                                <span class="badge bg-success">Paid</span>
                            {% elif inv.status == 'Unpaid' %}
                                <span class="badge bg-danger">Unpaid</span>
                            {% else %}
                                <span class="badge bg-secondary">{{ inv.status }}</span>
                            {% endif %}
                        </td>
                        <td class="text-end pe-4 fw-bold">{{ currency }}{{ "%.2f"|format(inv.total or 0) }}</td>
                        <td class="text-center">
                            <<a href="{{ url_for('pdf.download_invoice_pdf', invoice_id=inv.id) }}" 
   target="_blank" 
   class="btn btn-sm btn-outline-dark" 
   title="View PDF">
   <i class="fas fa-file-pdf"></i>
</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="7" class="text-center py-5 text-muted">No invoices found. Generate one from a Quote.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}