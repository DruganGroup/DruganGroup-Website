{% extends "finance/settings_layout.html" %}

{% block settings_content %}
<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card p-4 bg-dark text-white text-center mb-3 shadow">
            <h6 class="text-uppercase text-white-50">Total Monthly Fixed Cost</h6>
            <h1 class="fw-bold text-warning mb-0">
                {{ currency_symbol }}
                {{ "%.2f"|format(total_overhead) }}
            </h1>
            <small class="text-white-50">Recurring fixed expenses only</small>
        </div>
        
        <div class="card p-3 bg-white border-dashed">
            <h6 class="fw-bold small text-uppercase mb-2 text-dark">Add New Category</h6>
            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"> <input type="hidden" name="action" value="add_category">
                <div class="input-group">
                    <input type="text" name="category_name" class="form-control" placeholder="e.g. Rent, Software..." required>
                    <button type="submit" class="btn btn-dark"><i class="fas fa-plus"></i></button>
                </div>
            </form>
        </div>
    </div>

    <div class="col-md-8">
        {% for cat in overheads %}
        <div class="card mb-3">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <strong class="text-uppercase">{{ cat.name }}</strong>
                <div>
                    <span class="badge bg-secondary me-2">{{ currency_symbol }}{{ "%.2f"|format(cat.total) }}</span>
                    <form method="POST" style="display:inline;" onsubmit="return confirm('Delete Category?');">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"> <input type="hidden" name="action" value="delete_category">
                        <input type="hidden" name="category_id" value="{{ cat.id }}">
                        <button type="submit" class="btn btn-sm text-danger border-0"><i class="fas fa-times"></i></button>
                    </form>
                </div>
            </div>
            <div class="card-body p-0">
                <table class="table table-striped mb-0">
                    {% for item in cat.items %}
                    <tr>
                        <td class="ps-3">{{ item[1] }}</td>
                        <td class="fw-bold text-end" style="width:120px;">{{ currency_symbol }}{{ item[2] }}</td>
                        <td style="width:40px;">
                            <form method="POST">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"> <input type="hidden" name="action" value="delete_item">
                                <input type="hidden" name="item_id" value="{{ item[0] }}">
                                <button type="submit" class="btn btn-sm text-danger p-0"><i class="fas fa-trash"></i></button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </table>
                <div class="p-2 border-top bg-light">
                    <form method="POST" class="row g-1">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"> <input type="hidden" name="action" value="add_item">
                        <input type="hidden" name="category_id" value="{{ cat.id }}">
                        <div class="col-7"><input type="text" name="item_name" class="form-control form-control-sm" placeholder="Item Name" required></div>
                        <div class="col-3"><input type="number" step="0.01" name="item_cost" class="form-control form-control-sm" placeholder="Cost" required></div>
                        <div class="col-2"><button type="submit" class="btn btn-sm btn-success w-100"><i class="fas fa-plus"></i></button></div>
                    </form>
                </div>
            </div>
        </div>
        {% else %}
        <div class="text-center text-muted py-5 border rounded bg-light">
            <i class="fas fa-chart-line fa-2x mb-2"></i>
            <p>No overheads tracked yet. Add a category to start.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}