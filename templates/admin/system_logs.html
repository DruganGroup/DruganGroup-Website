{% extends "admin/base.html" %}

{% block title %}System Logs | Business Better{% endblock %}

{% block styles %}
<style>
    /* --- Page Specific Styles --- */
    
    /* 1. TABLE HEADERS (Changed from Red to Gold) */
    .table-dark-custom th { 
        color: var(--primary-gold) !important; 
        border-color: var(--primary-gold) !important;
    }

    /* 2. LOG TRACE BOX (The detailed error message box) */
    .log-trace { 
        background: #111; 
        color: var(--primary-gold);  /* Text Color */
        padding: 20px; 
        font-family: monospace; 
        font-size: 0.8rem; 
        border-left: 3px solid var(--primary-gold); /* Left Border Line */
        margin: 10px 0;
        white-space: pre-wrap;
    }

    /* 3. BUTTON HOVER EFFECT */
    .btn-view-trace {
        background: transparent;
        border: 1px solid #555;
        color: #aaa;
        padding: 5px 15px;
        border-radius: 5px;
        font-size: 0.8rem;
        transition: 0.3s;
    }
    .btn-view-trace:hover {
        border-color: var(--primary-gold);
        color: var(--primary-gold);
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-end mb-5">
    <div>
        <h6 class="text-muted text-uppercase mb-1">System Health</h6>
        <h2 class="fw-bold mb-0 text-white">Error <span style="color: var(--primary-gold);">Logs</span></h2>
    </div>
    <div>
        <span class="text-muted" style="font-size: 0.9rem;">Automatic crash reports</span>
    </div>
</div>

<div class="card-dark shadow-lg" style="border-top: 3px solid var(--primary-gold);">
    <table class="table table-dark-custom table-hover mb-0">
        <thead>
            <tr>
                <th>Time</th>
                <th>Route</th>
                <th>Message</th>
                <th>Debug</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td style="width: 15%; font-family: monospace; color: #aaa;">{{ log[5].strftime('%d-%b %H:%M:%S') }}</td>
                <td style="width: 20%"><code style="color: var(--primary-gold);">{{ log[4] }}</code></td>
                <td>{{ log[2] }}</td>
                <td style="width: 10%">
                    <button class="btn-view-trace" onclick="toggleTrace({{ log[0] }})">Details</button>
                </td>
            </tr>
            <tr id="trace-{{ log[0] }}" style="display:none; background: #181818;">
                <td colspan="4">
                    <div class="log-trace">{{ log[3] }}</div>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="4" class="text-center p-5 text-success">âœ… System is healthy. No errors recorded.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
<script>
    function toggleTrace(id) {
        var x = document.getElementById('trace-' + id);
        if (x.style.display === "none") { x.style.display = "table-row"; } else { x.style.display = "none"; }
    }
</script>
{% endblock %}