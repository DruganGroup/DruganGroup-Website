{% extends "admin/base.html" %}

{% block title %}Search Results | Business Better{% endblock %}

{% block styles %}
<style>
    /* --- Page Specific Styles --- */
    .result-header { 
        padding: 15px 20px; 
        font-family: 'Montserrat', sans-serif; 
        font-weight: 700; 
        text-transform: uppercase; 
        font-size: 0.9rem; 
        letter-spacing: 1px; 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
    }
    
    /* Section Header Colors */
    .header-company { background: rgba(197, 160, 89, 0.15); color: var(--primary-gold); border-bottom: 1px solid rgba(197, 160, 89, 0.3); }
    .header-user { background: rgba(52, 152, 219, 0.15); color: #3498db; border-bottom: 1px solid rgba(52, 152, 219, 0.3); }
    .header-invoice { background: rgba(46, 204, 113, 0.15); color: #2ecc71; border-bottom: 1px solid rgba(46, 204, 113, 0.3); }
    .header-vehicle { background: rgba(155, 89, 182, 0.15); color: #9b59b6; border-bottom: 1px solid rgba(155, 89, 182, 0.3); }
    
    /* Action Buttons */
    .btn-action { 
        padding: 5px 15px; 
        border-radius: 5px; 
        font-size: 0.8rem; 
        font-weight: 600; 
        text-decoration: none; 
        border: 1px solid #444; 
        color: #ccc; 
        transition: 0.3s;
    }
    .btn-action:hover { 
        border-color: var(--primary-gold); 
        color: var(--primary-gold); 
        background: rgba(255,255,255,0.05);
    }
</style>
{% endblock %}

{% block content %}
<div class="mb-5">
    <h6 class="text-muted text-uppercase mb-1">Global Search</h6>
    <h2 class="fw-bold mb-0 text-white">Results for "<span class="text-gold">{{ query }}</span>"</h2>
</div>

{% if results.companies %}
<div class="card-dark mb-4">
    <div class="result-header header-company">
        <span><i class="fas fa-building me-2"></i> Companies Found</span>
        <span class="badge bg-dark">{{ results.companies|length }}</span>
    </div>
    <table class="table table-dark-custom table-hover m-0">
        <thead>
            <tr>
                <th>Name</th>
                <th>Subdomain</th>
                <th>Email</th>
                <th class="text-end">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for c in results.companies %}
            <tr>
                <td class="fw-bold text-white">{{ c[1] }}</td>
                <td>{{ c[2] }}.businessbetter.co.uk</td>
                <td>{{ c[3] }}</td>
                <td class="text-end"><a href="/super-admin/company/{{ c[0] }}" class="btn-action">Manage</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% if results.users %}
<div class="card-dark mb-4">
    <div class="result-header header-user">
        <span><i class="fas fa-users me-2"></i> Users Found</span>
        <span class="badge bg-dark">{{ results.users|length }}</span>
    </div>
    <table class="table table-dark-custom table-hover m-0">
        <thead>
            <tr>
                <th style="color: #3498db; border-color: rgba(52, 152, 219, 0.3);">Name</th>
                <th style="color: #3498db; border-color: rgba(52, 152, 219, 0.3);">Email</th>
                <th style="color: #3498db; border-color: rgba(52, 152, 219, 0.3);">Role</th>
                <th class="text-end" style="color: #3498db; border-color: rgba(52, 152, 219, 0.3);">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for u in results.users %}
            <tr>
                <td class="fw-bold text-white">{{ u[1] }}</td>
                <td>{{ u[2] }}</td>
                <td>{{ u[3] }}</td>
                <td class="text-end">
                    <a href="/admin/users/edit/{{ u[0] }}" class="btn-action">View User</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% if results.invoices %}
<div class="card-dark mb-4">
    <div class="result-header header-invoice">
        <span><i class="fas fa-file-invoice-dollar me-2"></i> Invoices Found</span>
        <span class="badge bg-dark">{{ results.invoices|length }}</span>
    </div>
    <table class="table table-dark-custom table-hover m-0">
        <thead>
            <tr>
                <th style="color: #2ecc71; border-color: rgba(46, 204, 113, 0.3);">Invoice #</th>
                <th style="color: #2ecc71; border-color: rgba(46, 204, 113, 0.3);">Date</th>
                <th style="color: #2ecc71; border-color: rgba(46, 204, 113, 0.3);">Total</th>
                <th class="text-end" style="color: #2ecc71; border-color: rgba(46, 204, 113, 0.3);">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for inv in results.invoices %}
            <tr>
                <td class="fw-bold text-white">#{{ inv[1] }}</td>
                <td>{{ inv[2] }}</td>
                <td class="text-white fw-bold">{{ inv[3] }}</td>
                <td class="text-end">
                    <a href="/admin/invoice/{{ inv[0] }}" class="btn-action">View Invoice</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% if not results.companies and not results.users and not results.invoices and not results.vehicles %}
    <div class="text-center py-5">
        <i class="fas fa-search fa-3x mb-3 text-muted"></i>
        <h3 class="text-muted">No results found for "{{ query }}"</h3>
        <p class="text-secondary">Try searching for a company name, email address, invoice number, or reg plate.</p>
    </div>
{% endif %}
{% endblock %}