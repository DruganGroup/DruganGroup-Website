{% extends "site/site_base.html" %}

{% block title %}Site Hub | Business Better{% endblock %}

{% block content %}
<div class="container py-3">

    <div class="card shadow-sm border-0 mb-4 overflow-hidden">
        {% if is_at_work %}
            <div class="card-body bg-primary text-white d-flex justify-content-between align-items-center p-4">
                <div>
                    <h2 class="fw-bold m-0"><i class="fas fa-sun me-2"></i>ON SHIFT</h2>
                    <small class="text-white-50">Clocked in for Payroll</small>
                </div>
                
                <form action="/site/toggle-day-clock" method="POST" class="m-0">
                    <input type="hidden" name="action" value="stop">
                    <button type="submit" class="btn btn-light text-primary fw-bold shadow-sm">
                        <i class="fas fa-sign-out-alt me-2"></i> End Day
                    </button>
                </form>
            </div>
        {% else %}
            <div class="card-body bg-dark text-white d-flex justify-content-between align-items-center p-4">
                <div>
                    <h2 class="fw-bold m-0">START DAY</h2>
                    <small class="text-white-50">Arrived at Yard/Site?</small>
                </div>
                
                <form action="/site/toggle-day-clock" method="POST" class="m-0">
                    <input type="hidden" name="action" value="start">
                    <button type="submit" class="btn btn-success fw-bold shadow btn-lg">
                        <i class="fas fa-clock me-2"></i> CLOCK IN
                    </button>
                </form>
            </div>
        {% endif %}
    </div>

    <div class="row g-2 mb-4">
        <div class="col-6">
            <a href="/site/van-check" class="text-decoration-none">
                <div class="card shadow-sm border-0 text-center py-4 h-100">
                    <i class="fas fa-shuttle-van fa-2x text-primary mb-2"></i>
                    <h6 class="fw-bold text-dark m-0 small">Van Check</h6>
                </div>
            </a>
        </div>

        <div class="col-6">
            <a href="/site/log-fuel" class="text-decoration-none">
                <div class="card shadow-sm border-0 text-center py-4 h-100">
                    <i class="fas fa-gas-pump fa-2x text-warning mb-2"></i>
                    <h6 class="fw-bold text-dark m-0 small">Log Fuel</h6>
                </div>
            </a>
        </div>
    </div>

    {% if active_job %}
    <div class="alert alert-warning border-start border-4 border-warning shadow-sm d-flex justify-content-between align-items-center mb-4">
        <div>
            <div class="small fw-bold text-uppercase text-muted">Currently Working On</div>
            <div class="fw-bold text-dark">{{ active_job.name }}</div>
        </div>
        <a href="/site/job/{{ active_job.id }}" class="btn btn-sm btn-dark fw-bold">View Job</a>
    </div>
    {% endif %}

    <div class="d-flex justify-content-between align-items-center mb-2 px-1">
        <h6 class="fw-bold text-uppercase text-secondary m-0 small">Upcoming Schedule</h6>
        <span class="badge bg-light text-dark border">{{ jobs|length }} Jobs</span>
    </div>

    {% if jobs %}
        {% for job in jobs %}
        <a href="/site/job/{{ job[0] }}" class="text-decoration-none text-dark">
            <div class="card shadow-sm border-0 mb-3">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            {% if job[6] == 'In Progress' %}
                                <span class="badge bg-success mb-2">Active</span>
                            {% elif job[6] == 'Scheduled' %}
                                <span class="badge bg-primary mb-2">
                                    {% if job[5] %}
                                        {{ job[5] }}
                                    {% else %}
                                        Scheduled
                                    {% endif %}
                                </span>
                            {% else %}
                                <span class="badge bg-secondary mb-2">{{ job[6] }}</span>
                            {% endif %}
                            
                            <h6 class="fw-bold m-0">{{ job[3] or 'Unknown Client' }}</h6>
                            <div class="text-muted small text-truncate" style="max-width: 200px;">
                                <i class="fas fa-map-marker-alt me-1 text-danger"></i> {{ job[2] or 'No Address' }}
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-muted mt-3"></i>
                    </div>
                </div>
            </div>
        </a>
        {% endfor %}
    
    {% else %}
        <div class="text-center py-5 text-muted">
            <i class="fas fa-mug-hot fa-3x mb-3 text-light-emphasis"></i>
            <p class="small">No upcoming jobs found.<br>Enjoy your brew!</p>
        </div>
    {% endif %}

</div>
{% endblock %}