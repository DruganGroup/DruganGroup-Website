<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ 'Quote' if is_quote else 'Invoice' }} {{ invoice.ref }}</title>
    <style>
        @page { margin: 0; size: A4; }
        :root { --brand: {{ config.color or '#333' }}; }
        
        body { 
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; 
            margin: 0; padding: 0; 
            color: #333; font-size: 13px; line-height: 1.5;
        }

        /* --- LAYOUT UTILITIES --- */
        .container { padding: 50px; }
        .row { display: flex; justify-content: space-between; }
        .col-6 { width: 48%; }
        .text-right { text-align: right; }
        .text-brand { color: var(--brand); }
        .bold { font-weight: 700; }
        .caps { text-transform: uppercase; letter-spacing: 1px; font-size: 10px; color: #999; }

        /* --- HEADER SECTION --- */
        .header { margin-bottom: 50px; border-bottom: 2px solid #f0f0f0; padding-bottom: 30px; }
        .logo { max-height: 80px; max-width: 250px; object-fit: contain; }
        
        .company-meta { text-align: right; font-size: 11px; color: #666; }
        .company-meta h2 { margin: 0 0 5px 0; font-size: 18px; color: var(--brand); }

        /* --- DOCUMENT BADGE --- */
        .doc-badge {
            background: var(--brand);
            color: white;
            padding: 8px 20px;
            font-size: 16px;
            font-weight: bold;
            display: inline-block;
            border-radius: 4px;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        /* --- CLIENT GRID --- */
        .bill-to { background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid var(--brand); }
        .bill-to h3 { margin-top: 0; font-size: 14px; margin-bottom: 5px; }
        
        .meta-data table { width: 100%; }
        .meta-data td { padding: 4px 0; }
        .meta-data .label { color: #999; font-size: 11px; text-transform: uppercase; }
        .meta-data .val { font-weight: bold; text-align: right; }

        /* --- LINE ITEMS TABLE --- */
        .items-table { width: 100%; border-collapse: collapse; margin-top: 40px; margin-bottom: 30px; }
        .items-table th { 
            text-align: left; padding: 12px 10px; 
            background: #f0f0f0; color: #555; 
            font-size: 11px; text-transform: uppercase; font-weight: 700;
            border-bottom: 2px solid var(--brand);
        }
        .items-table td { padding: 12px 10px; border-bottom: 1px solid #eee; }
        .items-table tr:last-child td { border-bottom: none; }

        /* --- TOTALS SECTION --- */
        .totals-box { width: 40%; margin-left: auto; }
        .total-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
        .total-row.grand { 
            border-top: 2px solid var(--brand); border-bottom: none; 
            font-size: 18px; font-weight: bold; color: var(--brand); margin-top: 10px; padding-top: 15px; 
        }

        /* --- FOOTER (BANKING) --- */
        .footer { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: #fcfcfc; border-top: 1px solid #eee; 
            padding: 30px 50px; font-size: 11px; color: #777; 
        }
        .bank-grid { display: flex; gap: 40px; margin-top: 15px; }
        .bank-item .lbl { display: block; font-size: 9px; text-transform: uppercase; color: #aaa; }
        .bank-item .val { display: block; font-weight: bold; color: #333; font-size: 12px; }

    </style>
</head>
<body>

    <div class="footer">
        <div class="row">
            <div class="col-6">
                <div class="caps" style="margin-bottom:5px;">Terms & Conditions</div>
                <div>{{ settings.get('invoice_footer', 'Payment is due within 14 days.') }}</div>
            </div>
            <div class="col-6">
                {% if settings.get('bank_name') %}
                <div class="caps" style="margin-bottom:5px;">Payment Details</div>
                <div class="bank-grid">
                    <div class="bank-item"><span class="lbl">Bank</span><span class="val">{{ settings.bank_name }}</span></div>
                    <div class="bank-item"><span class="lbl">Sort Code</span><span class="val">{{ settings.sort_code }}</span></div>
                    <div class="bank-item"><span class="lbl">Account No</span><span class="val">{{ settings.account_number }}</span></div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="container">
        
        <div class="header row">
            <div class="col-6">
                {% if config.logo %}
                    <img src="{{ config.logo }}" class="logo">
                {% else %}
                    <h1 class="text-brand">{{ company.name }}</h1>
                {% endif %}
            </div>
            <div class="col-6 company-meta">
                <h2>{{ company.name }}</h2>
                {{ settings.get('company_address') }}<br>
                {{ settings.get('company_email') }} | {{ settings.get('company_phone') }}<br>
                {% if settings.get('tax_id') %}<strong>Tax ID:</strong> {{ settings.tax_id }}{% endif %}
            </div>
        </div>

        <div class="row">
            <div class="col-6 bill-to">
                <div class="caps">Bill To:</div>
                <h3>{{ invoice.client_name }}</h3>
                <div>{{ invoice.client_address | replace(',', '<br>') | safe }}</div>
                <div style="margin-top:5px; font-size:11px;">{{ invoice.client_email }}</div>
            </div>
            
            <div class="col-6 text-right meta-data" style="width: 35%;">
                <div class="doc-badge">{{ 'QUOTE' if is_quote else 'INVOICE' }}</div>
                <table>
                    <tr><td class="label">Reference:</td><td class="val">#{{ invoice.ref }}</td></tr>
                    <tr><td class="label">Issue Date:</td><td class="val">{{ invoice.date }}</td></tr>
                    {% if not is_quote %}
                        <tr><td class="label">Due Date:</td><td class="val">{{ invoice.due_date }}</td></tr>
                    {% else %}
                        <tr><td class="label">Expires:</td><td class="val">{{ invoice.expiry }}</td></tr>
                    {% endif %}
                </table>
            </div>
        </div>

        <table class="items-table">
            <thead>
                <tr>
                    <th width="50%">Description</th>
                    <th width="10%" class="text-center">Qty</th>
                    <th width="20%" class="text-right">Unit Price</th>
                    <th width="20%" class="text-right">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>
                        <div class="bold">{{ item.desc }}</div>
                        {% if item.notes %}<div style="color:#777; font-size:11px;">{{ item.notes }}</div>{% endif %}
                    </td>
                    <td class="text-center">{{ item.qty }}</td>
                    <td class="text-right">£{{ "%.2f"|format(item.price) }}</td>
                    <td class="text-right">£{{ "%.2f"|format(item.total) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="totals-box">
            <div class="total-row">
                <span>Subtotal</span>
                <span>£{{ "%.2f"|format(invoice.total) }}</span>
            </div>
            
            {% if settings.get('vat_registered') == 'yes' %}
            <div class="total-row">
                <span>VAT (20%)</span>
                <span>£{{ "%.2f"|format(invoice.total * 0.2) }}</span>
            </div>
            <div class="total-row grand">
                <span>Total</span>
                <span>£{{ "%.2f"|format(invoice.total * 1.2) }}</span>
            </div>
            {% else %}
            <div class="total-row grand">
                <span>Total</span>
                <span>£{{ "%.2f"|format(invoice.total) }}</span>
            </div>
            {% endif %}
        </div>

    </div>
</body>
</html>