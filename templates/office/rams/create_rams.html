{% extends "office/office_base.html" %}

{% block title %}Create RAMS | {{ data.ref }}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-clipboard-check me-2"></i>Risk Assessment (RAMS)</h2>
        <a href="/office/job/{{ data.job_id }}/files" class="btn btn-outline-secondary">Cancel</a>
    </div>

    <form action="/office/job/{{ data.job_id }}/rams/save" method="POST">
	<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="ref" value="{{ data.ref }}">
        <input type="hidden" name="client" value="{{ data.client }}">
        <input type="hidden" name="address" value="{{ data.address }}">

        <div class="row g-4">
            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-danger text-white fw-bold">1. Identified Hazards</div>
                    <div class="card-body">
                        <p class="small text-muted mb-3">
                            <i class="fas fa-magic me-1"></i> Auto-detected based on job description: 
                            <strong>{{ data.hazards|join(', ') }}</strong>
                        </p>
                        <div class="row g-2">
                            {% set all_hazards = ['Slips, Trips & Falls', 'Working at Height', 'Electricity', 'Asbestos', 'Dust & Fumes', 'Noise', 'Manual Handling', 'Moving Vehicles', 'Sharp Objects', 'Chemicals / COSHH'] %}
                            {% for haz in all_hazards %}
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="hazards" value="{{ haz }}" id="h_{{ loop.index }}" 
                                    {% if haz in data.hazards %}checked{% endif %}>
                                    <label class="form-check-label" for="h_{{ loop.index }}">{{ haz }}</label>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-primary text-white fw-bold">2. Required PPE</div>
                    <div class="card-body">
                        <div class="row g-2">
                            {% set all_ppe = ['Safety Boots', 'Hi-Vis Vest', 'Hard Hat', 'Safety Glasses', 'Ear Defenders', 'Dust Mask', 'Insulated Gloves', 'Knee Pads'] %}
                            {% for item in all_ppe %}
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="ppe" value="{{ item }}" id="p_{{ loop.index }}"
                                    {% if item in data.ppe %}checked{% endif %}>
                                    <label class="form-check-label" for="p_{{ loop.index }}">{{ item }}</label>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-dark text-white fw-bold">3. Method Statement</div>
                    <div class="card-body">
                        <label class="form-label small fw-bold text-muted">Sequence of Works</label>
                        <textarea class="form-control" name="method_statement" rows="8" required>{{ data.method }}</textarea>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-grid mt-4">
            <button type="submit" class="btn btn-success btn-lg fw-bold">
                <i class="fas fa-file-pdf me-2"></i>Generate & Save RAMS PDF
            </button>
        </div>
    </form>
</div>
{% endblock %}